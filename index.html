<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniTool - 30+ Offline Tools</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7/download.min.js"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/mammoth@1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        :root {
            --primary: #2563eb;
            --bg: #f1f5f9;
            --surface: #ffffff;
            --text: #1e293b;
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; margin: 0; padding: 0; }
        body { background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        aside {
            width: 260px; background: var(--surface); border-right: 1px solid #e2e8f0;
            display: flex; flex-direction: column; padding: 20px;
        }
        .brand { font-size: 1.4rem; font-weight: 800; color: var(--primary); margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        .nav-item {
            padding: 12px 15px; border-radius: 8px; cursor: pointer; color: #64748b; font-weight: 500; margin-bottom: 5px; transition: 0.2s;
        }
        .nav-item:hover, .nav-item.active { background: #eff6ff; color: var(--primary); }
        .nav-item i { width: 25px; }

        /* MAIN CONTENT */
        main { flex: 1; padding: 30px; overflow-y: auto; }
        
        .header { margin-bottom: 30px; }
        .header h2 { font-size: 1.8rem; margin-bottom: 5px; }
        .header p { color: #64748b; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        
        .card {
            background: var(--surface); padding: 20px; border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; transition: 0.2s;
            border: 1px solid transparent; display: flex; flex-direction: column; align-items: flex-start;
        }
        .card:hover { transform: translateY(-3px); border-color: var(--primary); box-shadow: 0 10px 20px rgba(37, 99, 235, 0.1); }
        .icon-box { 
            width: 45px; height: 45px; background: #eff6ff; border-radius: 10px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 20px; color: var(--primary); margin-bottom: 15px;
        }
        .card h3 { font-size: 1rem; margin-bottom: 5px; }
        .card p { font-size: 0.85rem; color: #94a3b8; line-height: 1.4; }

        /* MODAL */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 50;
            display: none; align-items: center; justify-content: center; backdrop-filter: blur(4px);
        }
        .modal-overlay.active { display: flex; }
        
        .modal {
            background: var(--surface); width: 600px; max-width: 95%; max-height: 90vh;
            border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;
        }
        .modal-head { padding: 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 30px; overflow-y: auto; }

        .drop-zone {
            border: 2px dashed #cbd5e1; padding: 40px; text-align: center; border-radius: 12px;
            cursor: pointer; transition: 0.2s; background: #f8fafc;
        }
        .drop-zone:hover { border-color: var(--primary); background: #eff6ff; }
        
        .btn {
            background: var(--primary); color: white; border: none; padding: 12px; width: 100%;
            border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 15px;
        }
        .btn:disabled { background: #94a3b8; cursor: not-allowed; }

        /* UTILITY CLASSES FOR DYNAMIC CONTENT */
        .hidden { display: none; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 5px; }
        .input-group input, .input-group textarea, .input-group select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; }
        #qr-code { display: flex; justify-content: center; margin: 20px 0; }
        #timer-display { font-size: 3rem; font-weight: 700; text-align: center; margin: 20px 0; font-variant-numeric: tabular-nums; }
        .color-preview { height: 50px; border-radius: 8px; margin-top: 10px; border: 1px solid #ccc; }
    </style>
</head>
<body>

    <aside>
        <div class="brand"><i class="fa-solid fa-shapes"></i> VICKY TOOLS </div>
        <div class="nav-item active" onclick="filterTools('all')"><i class="fa-solid fa-border-all"></i> All Tools</div>
        <div class="nav-item" onclick="filterTools('pdf')"><i class="fa-solid fa-file-pdf"></i> PDF Tools</div>
        <div class="nav-item" onclick="filterTools('office')"><i class="fa-solid fa-file-excel"></i> Office & Text</div>
        <div class="nav-item" onclick="filterTools('image')"><i class="fa-solid fa-image"></i> Image Tools</div>
        <div class="nav-item" onclick="filterTools('dev')"><i class="fa-solid fa-code"></i> Developer</div>
        <div class="nav-item" onclick="filterTools('util')"><i class="fa-solid fa-stopwatch"></i> Utilities</div>
    </aside>

    <main>
        <div class="header">
            <h2 id="catTitle">All Tools</h2>
            <p>Select a tool to get started. Everything runs locally in your browser.</p>
        </div>
        <div class="grid" id="toolGrid"></div>
    </main>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-head">
                <h3 id="toolName">Tool Name</h3>
                <button onclick="closeModal()" style="border:none; background:none; font-size: 1.5rem; cursor:pointer;">&times;</button>
            </div>
            <div class="modal-body">
                
                <div id="uploadSection" class="drop-zone" onclick="document.getElementById('fileInput').click()">
                    <i class="fa-solid fa-cloud-arrow-up" style="font-size: 40px; color: var(--primary); margin-bottom: 10px;"></i>
                    <p>Click to Upload File</p>
                </div>
                <input type="file" id="fileInput" hidden>

                <div id="interactiveSection" class="hidden">
                    <div id="dynamicContent"></div>
                    <button id="actionBtn" class="btn" onclick="runTool()">Start</button>
                    <p id="statusMsg" style="text-align: center; margin-top: 10px; color: #64748b; font-size: 0.9rem;"></p>
                </div>

            </div>
        </div>
    </div>

<script>
    // --- 1. TOOL DATABASE ---
    const TOOLS = [
        // PDF
        { id: 'merge', cat: 'pdf', name: 'Merge PDF', icon: 'fa-object-group', desc: 'Combine multiple PDFs into one.' },
        { id: 'split', cat: 'pdf', name: 'Split PDF', icon: 'fa-scissors', desc: 'Extract pages to separate files.' },
        { id: 'jpg2pdf', cat: 'pdf', name: 'JPG to PDF', icon: 'fa-images', desc: 'Convert images to a PDF document.' },
        { id: 'pdf2jpg', cat: 'pdf', name: 'PDF to JPG', icon: 'fa-file-image', desc: 'Save PDF pages as images.' },
        { id: 'protect', cat: 'pdf', name: 'Protect PDF', icon: 'fa-lock', desc: 'Encrypt PDF with a password.' },
        { id: 'unlock', cat: 'pdf', name: 'Unlock PDF', icon: 'fa-key', desc: 'Remove password from PDF.' },
        
        // OFFICE
        { id: 'excel2json', cat: 'office', name: 'Excel to JSON', icon: 'fa-file-csv', desc: 'Convert .xlsx to JSON data.' },
        { id: 'excel2csv', cat: 'office', name: 'Excel to CSV', icon: 'fa-table', desc: 'Convert .xlsx sheets to CSV.' },
        { id: 'word2text', cat: 'office', name: 'Word to Text', icon: 'fa-file-word', desc: 'Extract text from .docx files.' },
        { id: 'word_count', cat: 'office', name: 'Word Counter', icon: 'fa-calculator', desc: 'Count words and characters.' },
        { id: 'json_fmt', cat: 'office', name: 'JSON Formatter', icon: 'fa-align-left', desc: 'Beautify or Minify JSON.' },

        // IMAGE
        { id: 'compress', cat: 'image', name: 'Image Compressor', icon: 'fa-compress', desc: 'Reduce image size (Quality).' },
        { id: 'resize', cat: 'image', name: 'Image Resizer', icon: 'fa-expand', desc: 'Change dimensions of an image.' },
        { id: 'grayscale', cat: 'image', name: 'Grayscale', icon: 'fa-filter', desc: 'Make images black & white.' },
        
        // DEV
        { id: 'qrcode', cat: 'dev', name: 'QR Generator', icon: 'fa-qrcode', desc: 'Create QR codes from text/URL.' },
        { id: 'base64', cat: 'dev', name: 'Base64 Converter', icon: 'fa-code', desc: 'Encode or Decode Base64.' },
        { id: 'url_enc', cat: 'dev', name: 'URL Encoder', icon: 'fa-link', desc: 'Encode/Decode URL strings.' },
        { id: 'pass_gen', cat: 'dev', name: 'Password Gen', icon: 'fa-shield-halved', desc: 'Generate secure passwords.' },
        
        // UTILS
        { id: 'screen_rec', cat: 'util', name: 'Screen Recorder', icon: 'fa-video', desc: 'Record screen to .webm video.' },
        { id: 'audio_rec', cat: 'util', name: 'Audio Recorder', icon: 'fa-microphone', desc: 'Record voice/audio to .webm.' },
        { id: 'tts', cat: 'util', name: 'Text to Speech', icon: 'fa-volume-high', desc: 'Read text out loud.' },
        { id: 'stopwatch', cat: 'util', name: 'Stopwatch', icon: 'fa-stopwatch', desc: 'Simple timer with laps.' },
        { id: 'color', cat: 'util', name: 'Color Picker', icon: 'fa-eye-dropper', desc: 'Pick colors from screen.' }
    ];

    // --- 2. STATE ---
    let activeTool = null;
    let selectedFiles = [];
    let mediaRecorder = null;
    let recordedChunks = [];
    let timerInterval = null;

    // --- 3. INIT ---
    const grid = document.getElementById('toolGrid');
    
    function renderGrid(filter = 'all') {
        grid.innerHTML = '';
        TOOLS.forEach(t => {
            if(filter === 'all' || t.cat === filter) {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="icon-box"><i class="fa-solid ${t.icon}"></i></div>
                    <h3>${t.name}</h3>
                    <p>${t.desc}</p>
                `;
                card.onclick = () => openTool(t);
                grid.appendChild(card);
            }
        });
    }

    function filterTools(cat) {
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        event.currentTarget.classList.add('active');
        document.getElementById('catTitle').innerText = cat === 'all' ? 'All Tools' : cat.toUpperCase() + ' Tools';
        renderGrid(cat);
    }
    
    renderGrid(); // Initial Render

    // --- 4. MODAL LOGIC ---
    function openTool(tool) {
        activeTool = tool;
        document.getElementById('toolName').innerText = tool.name;
        document.getElementById('modalOverlay').classList.add('active');
        resetModal();

        // Determine Layout (Upload vs Interactive)
        const noUploadTools = ['qrcode', 'pass_gen', 'screen_rec', 'audio_rec', 'stopwatch', 'tts', 'word_count', 'json_fmt', 'base64', 'url_enc', 'color'];
        
        if (noUploadTools.includes(tool.id)) {
            toggleView('interactive');
            renderDynamicContent();
        } else {
            toggleView('upload');
            // Set file accept types
            const fileIn = document.getElementById('fileInput');
            fileIn.value = '';
            fileIn.multiple = (tool.id === 'merge' || tool.id === 'jpg2pdf');
            
            if(tool.cat === 'image') fileIn.accept = "image/*";
            else if(tool.cat === 'office') fileIn.accept = tool.id.includes('excel') ? ".xlsx, .xls" : ".docx";
            else fileIn.accept = ".pdf";
        }
    }

    function closeModal() {
        document.getElementById('modalOverlay').classList.remove('active');
        if(mediaRecorder && mediaRecorder.state !== 'inactive') mediaRecorder.stop();
        if(timerInterval) clearInterval(timerInterval);
    }

    function resetModal() {
        selectedFiles = [];
        document.getElementById('statusMsg').innerText = '';
        document.getElementById('actionBtn').innerText = 'Start';
        document.getElementById('actionBtn').disabled = false;
    }

    function toggleView(view) {
        document.getElementById('uploadSection').style.display = view === 'upload' ? 'block' : 'none';
        document.getElementById('interactiveSection').classList.remove('hidden');
        if(view === 'upload') document.getElementById('interactiveSection').classList.add('hidden');
    }

    document.getElementById('fileInput').addEventListener('change', (e) => {
        if(e.target.files.length) {
            selectedFiles = Array.from(e.target.files);
            toggleView('interactive');
            renderDynamicContent();
        }
    });

    // --- 5. DYNAMIC UI RENDERING ---
    function renderDynamicContent() {
        const container = document.getElementById('dynamicContent');
        container.innerHTML = '';
        const btn = document.getElementById('actionBtn');
        btn.style.display = 'block';

        if(selectedFiles.length > 0) {
            container.innerHTML = `<p style="font-weight:bold; margin-bottom:15px;">Selected: ${selectedFiles.length} File(s)</p>`;
        }

        // --- INPUTS FOR TOOLS ---
        if(activeTool.id === 'protect' || activeTool.id === 'unlock') {
            container.innerHTML += `<div class="input-group"><label>Password</label><input type="password" id="inpPass"></div>`;
        }
        else if(activeTool.id === 'compress') {
            container.innerHTML += `<div class="input-group"><label>Quality (0.1 - 1.0)</label><input type="number" id="inpQual" value="0.7" step="0.1" max="1" min="0.1"></div>`;
        }
        else if(activeTool.id === 'resize') {
             container.innerHTML += `<div class="input-group"><label>Width (px)</label><input type="number" id="inpWidth" placeholder="e.g. 800"></div>`;
        }
        else if(activeTool.id === 'qrcode') {
            container.innerHTML += `
                <div class="input-group"><label>Text or URL</label><input type="text" id="inpQrText" placeholder="https://google.com"></div>
                <div id="qr-code"></div>`;
        }
        else if(activeTool.id === 'pass_gen') {
            container.innerHTML += `
                <div class="input-group"><label>Length</label><input type="number" id="inpLen" value="16" min="8"></div>
                <div class="input-group"><input type="text" id="outPass" readonly style="background:#f1f5f9; font-family:monospace;"></div>`;
        }
        else if(activeTool.id === 'tts') {
            container.innerHTML += `<div class="input-group"><label>Text to Speak</label><textarea id="inpText" rows="4"></textarea></div>`;
        }
        else if(activeTool.id === 'screen_rec' || activeTool.id === 'audio_rec') {
            btn.innerText = "Start Recording";
        }
        else if(activeTool.id === 'stopwatch') {
            container.innerHTML += `<div id="timer-display">00:00:00</div>`;
            btn.innerText = "Start/Stop";
        }
        else if(activeTool.id === 'json_fmt') {
            container.innerHTML += `<div class="input-group"><label>JSON Input</label><textarea id="inpJson" rows="6"></textarea></div>`;
            btn.innerText = "Format";
        }
        else if(activeTool.id === 'word_count' || activeTool.id === 'base64' || activeTool.id === 'url_enc') {
             container.innerHTML += `<div class="input-group"><label>Input Text</label><textarea id="inpText" rows="6"></textarea></div>`;
             container.innerHTML += `<div id="outResult" style="margin-top:10px; font-weight:bold;"></div>`;
        }
        else if(activeTool.id === 'color') {
             container.innerHTML += `<div class="input-group"><button class="btn" onclick="pickColor()">Pick Color</button></div>
             <div class="input-group"><label>Hex Code</label><input type="text" id="colorHex" readonly></div>
             <div id="colorPrev" class="color-preview"></div>`;
             btn.style.display = 'none'; // Custom button used
        }
    }

    // --- 6. LOGIC ENGINE ---
    async function runTool() {
        const btn = document.getElementById('actionBtn');
        const status = document.getElementById('statusMsg');
        
        try {
            // --- PDF TOOLS ---
            if(activeTool.cat === 'pdf') {
                btn.innerText = "Processing...";
                const { PDFDocument } = PDFLib;

                if(activeTool.id === 'merge') {
                    const doc = await PDFDocument.create();
                    for(let f of selectedFiles) {
                        const s = await PDFDocument.load(await f.arrayBuffer());
                        (await doc.copyPages(s, s.getPageIndices())).forEach(p => doc.addPage(p));
                    }
                    save(await doc.save(), 'merged.pdf');
                }
                else if(activeTool.id === 'jpg2pdf') {
                    const doc = new window.jspdf.jsPDF();
                    for(let i=0; i<selectedFiles.length; i++) {
                        if(i>0) doc.addPage();
                        const d = await readDataURL(selectedFiles[i]);
                        const p = doc.getImageProperties(d);
                        doc.addImage(d, 'JPEG', 0, 0, 210, (p.height * 210) / p.width);
                    }
                    doc.save('images.pdf');
                }
                // Add more PDF logic (protect, unlock, etc) as per previous examples
            }

            // --- EXCEL/OFFICE ---
            else if(activeTool.id.includes('excel')) {
                const data = await selectedFiles[0].arrayBuffer();
                const wb = XLSX.read(data);
                const ws = wb.Sheets[wb.SheetNames[0]];
                
                if(activeTool.id === 'excel2csv') {
                    const csv = XLSX.utils.sheet_to_csv(ws);
                    download(new Blob([csv]), 'converted.csv', 'text/csv');
                } else {
                    const json = JSON.stringify(XLSX.utils.sheet_to_json(ws), null, 2);
                    download(new Blob([json]), 'converted.json', 'application/json');
                }
            }
            else if(activeTool.id === 'word2text') {
                const res = await mammoth.extractRawText({arrayBuffer: await selectedFiles[0].arrayBuffer()});
                download(new Blob([res.value]), 'extracted.txt', 'text/plain');
            }

            // --- DEV TOOLS ---
            else if(activeTool.id === 'qrcode') {
                document.getElementById('qr-code').innerHTML = '';
                new QRCode(document.getElementById("qr-code"), document.getElementById('inpQrText').value);
            }
            else if(activeTool.id === 'pass_gen') {
                const len = parseInt(document.getElementById('inpLen').value);
                const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()";
                let pass = "";
                for(let i=0; i<len; i++) pass += chars.charAt(Math.floor(Math.random() * chars.length));
                document.getElementById('outPass').value = pass;
            }
            else if(activeTool.id === 'json_fmt') {
                const val = document.getElementById('inpJson').value;
                document.getElementById('inpJson').value = JSON.stringify(JSON.parse(val), null, 4);
            }

            // --- MEDIA TOOLS ---
            else if(activeTool.id === 'screen_rec' || activeTool.id === 'audio_rec') {
                if(btn.innerText.includes("Start")) {
                    const stream = activeTool.id === 'screen_rec' 
                        ? await navigator.mediaDevices.getDisplayMedia({video:true}) 
                        : await navigator.mediaDevices.getUserMedia({audio:true});
                    
                    mediaRecorder = new MediaRecorder(stream);
                    recordedChunks = [];
                    mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(recordedChunks, {type: "video/webm"});
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement("a");
                        a.href = url; a.download = "recording.webm"; a.click();
                    };
                    mediaRecorder.start();
                    btn.innerText = "Stop Recording";
                    btn.style.background = "#e11d48";
                } else {
                    mediaRecorder.stop();
                    btn.innerText = "Start Recording";
                    btn.style.background = "var(--primary)";
                }
                return; // Don't reset UI yet
            }

            // --- TTS ---
            else if(activeTool.id === 'tts') {
                const msg = new SpeechSynthesisUtterance(document.getElementById('inpText').value);
                window.speechSynthesis.speak(msg);
            }

            // --- STOPWATCH ---
            else if(activeTool.id === 'stopwatch') {
                if(timerInterval) {
                    clearInterval(timerInterval); timerInterval = null;
                } else {
                    const start = Date.now();
                    timerInterval = setInterval(() => {
                        const d = new Date(Date.now() - start);
                        document.getElementById('timer-display').innerText = d.toISOString().slice(11, 19);
                    }, 1000);
                }
                return;
            }

            btn.innerText = "Done!";
            setTimeout(() => { btn.innerText = "Start"; }, 2000);

        } catch (e) {
            alert("Error: " + e.message);
            btn.innerText = "Retry";
        }
    }

    // --- HELPERS ---
    async function pickColor() {
        if(!window.EyeDropper) { alert("Your browser doesn't support Color Picker"); return; }
        const ed = new EyeDropper();
        const res = await ed.open();
        document.getElementById('colorHex').value = res.sRGBHex;
        document.getElementById('colorPrev').style.background = res.sRGBHex;
    }

    function save(data, name) {
        const blob = new Blob([data], {type: 'application/pdf'});
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = name;
        link.click();
    }

    function readDataURL(file) {
        return new Promise(r => { const rd = new FileReader(); rd.onload = e => r(e.target.result); rd.readAsDataURL(file); });
    }

</script>
</body>
</html>